{% extends 'base.html' %}
{% load static %}

{% block title %}Search Lost Pets | PetRescue{% endblock %}

{% block content %}
<div class="container mt-4">
  <!-- Hero Section -->
  <div class="row mb-5">
    <div class="col-12">
      <div class="card border-0 rounded-3 overflow-hidden shadow-lg">
        <img src="https://images.unsplash.com/photo-1517423568366-8b83523034fd?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1200&q=80" 
             class="card-img-top" alt="Lost pet search" style="max-height: 500px; object-fit: cover;">
        <div class="card-img-overlay d-flex align-items-center justify-content-center">
          <div class="bg-dark bg-opacity-75 p-4 rounded text-center text-white" style="max-width: 600px;">
            <h1 class="card-title mb-3">Find Your Lost Pet</h1>
            <p class="card-text mb-4">Search our database of found pets to help reunite you with your missing companion.</p>
            <a href="#search-section" class="btn btn-success btn-lg me-2">Search Found Pets</a>
            <a href="#available-pets-section" class="btn btn-primary btn-lg">See All Founded Pets</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search/Filter Section -->
  <div class="row mb-5" id="search-section">
    <div class="col-12">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-header bg-white border-0">
          <h2 class="mb-0 text-center">Search Found Pets</h2>
          <p class="text-center text-muted mb-0">Use filters to narrow down your search for your lost pet</p>
        </div>
        <div class="card-body">
          <form method="GET" id="pet-search-form">
            <div class="row g-3">
              <div class="col-md-4 mb-3">
                <label for="{{ search_form.pet_type.id_for_label }}" class="form-label">Pet Type</label>
                {{ search_form.pet_type }}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ search_form.breed.id_for_label }}" class="form-label">Breed</label>
                {{ search_form.breed }}
              </div>
              <div class="col-md-4 mb-3">
                <label for="{{ search_form.color.id_for_label }}" class="form-label">Color</label>
                {{ search_form.color }}
              </div>
              <div class="col-md-6 mb-3">
                <label for="{{ search_form.location.id_for_label }}" class="form-label">Location</label>
                {{ search_form.location }}
              </div>
              <div class="col-md-3 mb-3">
                <label for="{{ search_form.start_date.id_for_label }}" class="form-label">From Date</label>
                {{ search_form.start_date }}
              </div>
              <div class="col-md-3 mb-3">
                <label for="{{ search_form.end_date.id_for_label }}" class="form-label">To Date</label>
                {{ search_form.end_date }}
              </div>
            </div>
            <div class="row mt-4">
              <div class="col-12 text-center">
                <button type="submit" class="btn btn-primary btn-lg px-5">Search Found Pets</button>
                <a href="{% url 'find_pets' %}" class="btn btn-outline-secondary btn-lg px-5 ms-2">Clear Filters</a>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Results Section -->
  <div class="row mb-5">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0" id="search-results">Found Pets Matching Your Search</h2>
        <div class="text-muted">
          {% if pets %}
            {{ pets|length }} pet{{ pets|length|pluralize }} found
          {% else %}
            No pets found
          {% endif %}
        </div>
      </div>
      
      {% if pets %}
        <!-- Pet Grid -->
        <div class="row g-4" id="pet-grid">
          {% for pet in pets %}
            <div class="col-md-6 col-lg-4">
              <div class="card h-100 shadow-sm border-0 rounded-3 pet-card">
                {% if pet.image %}
                  <img src="{{ pet.image.url }}" class="card-img-top" alt="{{ pet.breed }}" style="height: 250px; object-fit: cover;">
                {% else %}
                  <div class="d-flex align-items-center justify-content-center" style="height: 250px; background-color: #f8f9fa;">
                    <i class="fas fa-paw fa-3x text-muted"></i>
                  </div>
                {% endif %}
                <div class="card-body d-flex flex-column">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title mb-0">{{ pet.breed }}</h5>
                    <span class="badge bg-success">Found</span>
                  </div>
                  <p class="card-text">
                    <small class="text-muted">
                      <i class="fas fa-paw me-1"></i> {{ pet.get_pet_type_display }}<br>
                      <i class="fas fa-palette me-1"></i> {{ pet.color }}<br>
                      <i class="fas fa-map-marker-alt me-1"></i> {{ pet.location }}<br>
                      <i class="fas fa-calendar-alt me-1"></i> {{ pet.created_at|date:"M d, Y" }}
                    </small>
                  </p>
                  <p class="flex-grow-1">{{ pet.description|truncatewords:20 }}</p>
                  <a href="#" class="btn btn-outline-primary mt-auto">View Details</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <!-- No Results Message -->
        <div class="text-center py-5">
          <div class="mb-4">
            <i class="fas fa-search fa-3x text-muted"></i>
          </div>
          <h3>No Found Pets Match Your Search</h3>
          <p class="lead">Try adjusting your filters or check back later as new pets are added regularly.</p>
          <a href="{% url 'find_pets' %}" class="btn btn-primary">Clear All Filters</a>
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Available Pets Section -->
  <div class="row mb-5" id="available-pets-section">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">All Founded Pets</h2>
        <div class="text-muted">
          {% if all_pets %}
            {{ all_pets|length }} pet{{ all_pets|length|pluralize }} founded
          {% else %}
            No pets founded
          {% endif %}
        </div>
      </div>
      
      {% if all_pets %}
        <!-- Available Pets Grid -->
        <div class="row g-4">
          {% for pet in all_pets %}
            <div class="col-md-6 col-lg-4">
              <div class="card h-100 shadow-sm border-0 rounded-3 pet-card">
                {% if pet.image %}
                  <img src="{{ pet.image.url }}" class="card-img-top" alt="{{ pet.breed }}" style="height: 250px; object-fit: cover;">
                {% else %}
                  <div class="d-flex align-items-center justify-content-center" style="height: 250px; background-color: #f8f9fa;">
                    <i class="fas fa-paw fa-3x text-muted"></i>
                  </div>
                {% endif %}
                <div class="card-body d-flex flex-column">
                  <div class="d-flex justify-content-between align-items-start mb-2">
                    <h5 class="card-title mb-0">{{ pet.breed }}</h5>
                    <span class="badge bg-success">Founded</span>
                  </div>
                  <p class="card-text">
                    <small class="text-muted">
                      <i class="fas fa-paw me-1"></i> {{ pet.get_pet_type_display }}<br>
                      <i class="fas fa-palette me-1"></i> {{ pet.color }}<br>
                      <i class="fas fa-map-marker-alt me-1"></i> {{ pet.location }}<br>
                      <i class="fas fa-calendar-alt me-1"></i> {{ pet.created_at|date:"M d, Y" }}
                    </small>
                  </p>
                  <p class="flex-grow-1">{{ pet.description|truncatewords:20 }}</p>
                  <a href="#" class="btn btn-outline-primary mt-auto">View Details</a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <!-- No Available Pets Message -->
        <div class="text-center py-5">
          <div class="mb-4">
            <i class="fas fa-paw fa-3x text-muted"></i>
          </div>
          <h3>No Pets Founded</h3>
          <p class="lead">Check back later as new pets are added regularly.</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block head_extra %}
<style>
  .card-img-overlay .bg-dark {
    background-color: rgba(0,0,0,0.75) !important;
  }
  
  .pet-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .pet-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.15) !important;
  }
  
  /* Add padding offset for fixed navbar */
  #search-results {
    scroll-margin-top: 70px;
  }
  
  #available-pets-section {
    scroll-margin-top: 70px;
  }
</style>
<script>
  // Scroll to search results after form submission
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('pet-search-form');
    if (form) {
      form.addEventListener('submit', function(e) {
        // Small delay to ensure page reloads before scrolling
        setTimeout(function() {
          const resultsSection = document.getElementById('search-results');
          if (resultsSection) {
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }, 100);
      });
    }
    
    // Check if there are search parameters in the URL and scroll to results
    if (window.location.search) {
      // Small delay to ensure content is loaded
      setTimeout(function() {
        const resultsSection = document.getElementById('search-results');
        if (resultsSection) {
          resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      }, 100);
    }
  });
</script>
{% endblock %}