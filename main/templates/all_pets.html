{% extends 'base.html' %}
{% load static %}

{% block title %}All Pets | PetRescue{% endblock %}

{% block content %}
<div class="container mt-4">
  <!-- Breadcrumb Navigation -->
  <nav aria-label="breadcrumb" class="fade-in">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
      <li class="breadcrumb-item active" aria-current="page">All Pets</li>
    </ol>
  </nav>

  <!-- Page Header -->
  <div class="row">
    <div class="col-12 text-center mb-5 fade-in-up">
      <h1 class="display-4 mb-3">All Pets</h1>
      <p class="lead">Browse all pets that have been accepted in our system. These pets are either lost and looking for their families or found and waiting to be reunited.</p>
    </div>
  </div>

  <!-- Filter Buttons -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex flex-wrap justify-content-center gap-2 fade-in-up">
        <button class="btn btn-outline-primary filter-btn active" data-filter="all">
          <i class="fas fa-list me-1"></i>All Pets
        </button>
        <button class="btn btn-outline-danger filter-btn" data-filter="lost">
          <i class="fas fa-search me-1"></i>Lost Pets
        </button>
        <button class="btn btn-outline-success filter-btn" data-filter="found">
          <i class="fas fa-home me-1"></i>Found Pets
        </button>
      </div>
    </div>
  </div>

  <!-- Loading indicator -->
  <div id="pets-loading" class="text-center py-5 d-none">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading pets...</span>
    </div>
    <p class="mt-2">Loading pets...</p>
  </div>

  <!-- Pets Grid -->
  <div class="row g-4" id="pets-container">
    {% if pets %}
      {% for pet in pets %}
        <div class="col-md-6 col-lg-4 fade-in-up pet-card-wrapper" data-status="{{ pet.status }}">
          <div class="card h-100 shadow-sm border-0 rounded-3 pet-card hover-lift">
            {% if pet.image %}
              <img src="{{ pet.image.url }}" class="card-img-top" alt="{{ pet.breed }} - {{ pet.color }} {{ pet.get_pet_type_display }}" style="height: 200px; object-fit: cover;" loading="lazy">
            {% else %}
              <div class="d-flex align-items-center justify-content-center image-placeholder" style="height: 200px;">
                <i class="fas fa-paw fa-3x text-muted"></i>
              </div>
            {% endif %}
            <div class="card-body d-flex flex-column">
              {% if pet.status == 'lost' %}
                <span class="status-badge status-badge-lost align-self-start mb-2">LOST</span>
              {% elif pet.status == 'found' %}
                <span class="status-badge status-badge-found align-self-start mb-2">FOUND</span>
              {% endif %}
              <h5 class="card-title">{{ pet.breed }}</h5>
              <p class="card-text flex-grow-1">
                <strong><i class="fas fa-paw me-1"></i></strong> {{ pet.get_pet_type_display }}<br>
                <strong><i class="fas fa-palette me-1"></i></strong> {{ pet.color }}<br>
                <strong><i class="fas fa-map-marker-alt me-1"></i></strong> {{ pet.location }}
              </p>
              <a href="{% url 'pet_detail' pet.id %}?ref=all_pets" class="btn btn-outline-primary mt-auto">
                <i class="fas fa-eye me-1"></i>View Details
              </a>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <!-- Fallback content if no pets are available -->
      <div class="col-12 text-center">
        <div class="py-5 fade-in-up">
          <i class="fas fa-paw fa-3x text-muted mb-3"></i>
          <h3 class="mb-3">No Pets Found</h3>
          <p class="lead">There are currently no accepted pets in our system. Check back later!</p>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- Pagination -->
  {% if pets.has_other_pages %}
  <div class="row mt-5">
    <div class="col-12">
      <nav aria-label="Pet pagination" class="d-flex justify-content-center">
        <ul class="pagination">
          {% if pets.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ pets.previous_page_number }}" aria-label="Previous">
                <span aria-hidden="true">&laquo;</span>
              </a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <span class="page-link">&laquo;</span>
            </li>
          {% endif %}
          
          {% for num in pets.paginator.page_range %}
            {% if pets.number == num %}
              <li class="page-item active" aria-current="page">
                <span class="page-link">{{ num }}</span>
              </li>
            {% elif num > pets.number|add:'-3' and num < pets.number|add:'3' %}
              <li class="page-item">
                <a class="page-link" href="?page={{ num }}">{{ num }}</a>
              </li>
            {% endif %}
          {% endfor %}
          
          {% if pets.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ pets.next_page_number }}" aria-label="Next">
                <span aria-hidden="true">&raquo;</span>
              </a>
            </li>
          {% else %}
            <li class="page-item disabled">
              <span class="page-link">&raquo;</span>
            </li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}

{% block head_extra %}
<style>
  .breadcrumb {
    background-color: transparent;
    padding: 0;
  }
  
  .filter-btn {
    transition: all 0.3s ease;
  }
  
  .filter-btn.active, .filter-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  
  .filter-btn.active {
    font-weight: 500;
  }
  
  .pet-card {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    height: 100%;
    /* Add hardware acceleration */
    transform: translateZ(0);
    will-change: transform;
  }
  
  .pet-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.15) !important;
  }
  
  .image-placeholder {
    background-color: var(--light-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--muted-text);
    border-radius: var(--border-radius);
  }
  
  @media (max-width: 768px) {
    .filter-btn {
      margin-bottom: 0.5rem;
    }
  }
  
  /* Performance optimization: Optimize all pets page elements */
  .breadcrumb, .filter-btn, .pet-card, .image-placeholder {
    contain: layout style paint;
  }
</style>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Filter functionality
    const filterButtons = document.querySelectorAll('.filter-btn');
    const petCards = document.querySelectorAll('.pet-card-wrapper');
    
    filterButtons.forEach(button => {
      button.addEventListener('click', function() {
        // Remove active class from all buttons
        filterButtons.forEach(btn => btn.classList.remove('active'));
        
        // Add active class to clicked button
        this.classList.add('active');
        
        // Get filter value
        const filterValue = this.getAttribute('data-filter');
        
        // Show/hide pet cards based on filter
        petCards.forEach(card => {
          if (filterValue === 'all') {
            card.style.display = 'block';
          } else {
            const petStatus = card.getAttribute('data-status');
            if (petStatus === filterValue) {
              card.style.display = 'block';
            } else {
              card.style.display = 'none';
            }
          }
        });
      });
    });
    
    // Add fade-in animation to pet cards
    const petCardWrappers = document.querySelectorAll('.pet-card-wrapper');
    petCardWrappers.forEach((wrapper, index) => {
      // Add delay for staggered animation
      wrapper.style.animationDelay = (index * 0.1) + 's';
    });
  });
</script>
{% endblock %}